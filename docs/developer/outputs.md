# Output Reference

This page documents all outputs generated by the pipeline. Understanding these outputs helps with debugging, quality control, and downstream analysis.

## How Outputs Are Organized

The pipeline organizes outputs into two main directories:

- **`results/images/`** - All processed image files organized by batch, processing stage, arm, and plate
- **`results/workspace/`** - Analysis outputs and QC reports

Within these, outputs follow a consistent naming pattern: `{batch}/{subfolder}/{arm}/{plate}/{plate}-{well}-{site}/`

## Directory Structure Overview

```
results/
├── images/
│   └── {batch}/
│       ├── illum/                          # Illumination functions
│       ├── images_corrected/               # Illumination-corrected images
│       ├── images_aligned/                 # Aligned barcoding images
│       ├── images_segmentation/            # Segmentation check outputs
│       ├── images_corrected_stitched/      # Stitched images (full resolution)
│       ├── images_corrected_cropped/       # Cropped images
│       └── images_corrected_stitched_10X/  # 10X downsampled stitched images
├── workspace/
│   ├── analysis/                           # Combined analysis outputs
│   └── qc_reports/                         # Quality control reports
│       ├── 1_illumination_painting/
│       ├── 3_segmentation/
│       ├── 4_stitching_painting/
│       ├── 5_illumination_barcoding/
│       ├── 6_alignment/
│       ├── 7_preprocessing/
│       └── 8_stitching_barcoding/
├── multiqc/                                # MultiQC summary reports
└── pipeline_info/                          # Nextflow execution reports and metadata
```

## Cell Painting Outputs

### Illumination Functions

**Location**: `results/images/{batch}/illum/{plate}/`

**Files**: `{plate}_Illum{channel}.npy`

**Description**: NumPy arrays containing illumination correction functions for each channel. Used to correct uneven illumination across the field of view.

**Example**:

```
results/images/Batch1/illum/Plate1/
  Plate1_IllumDAPI.npy
  Plate1_IllumGFP.npy
  Plate1_IllumRFP.npy
```

### Corrected Images

**Location**: `results/images/{batch}/images_corrected/painting/{plate}/{plate}-{well}-{site}/`

**Files**: `Plate_{plate}_Well_{well}_Site_{site}_Corr{channel}.tiff`

**Description**: Multi-frame TIFF images with illumination correction applied. One file per channel per site.

**Example**:

```
results/images/Batch1/images_corrected/painting/Plate1/Plate1-A1-1/
  Plate_Plate1_Well_A1_Site_1_CorrDAPI.tiff
  Plate_Plate1_Well_A1_Site_1_CorrGFP.tiff
  Plate_Plate1_Well_A1_Site_1_CorrRFP.tiff
```

### Segmentation Check

**Location**: `results/images/{batch}/images_segmentation/painting/{plate}/{plate}-{well}/`

**Files**: Segmentation preview images (`*.png`) and CSV summaries

**Description**: QC outputs from the segmentation check step.

### Stitched Images

**Location**: `results/images/{batch}/images_corrected_stitched/painting/{plate}/{plate}-{well}/`

**Files**: `*.tiff`, `TileConfiguration.txt`

**Description**: Stitched full-resolution images for each well. Generated only if `qc_painting_passed == true`. Includes the FIJI TileConfiguration file for reference.

### Cropped Images

**Location**: `results/images/{batch}/images_corrected_cropped/painting/{plate}/{plate}-{well}/`

**Files**: `*.tiff`

**Description**: Cropped images with overlap regions removed.

### 10X Downsampled Images

**Location**: `results/images/{batch}/images_corrected_stitched_10X/painting/{plate}/{plate}-{well}/`

**Files**: `*.tiff`

**Description**: 10X downsampled versions of stitched images for quick visualization.

## Barcoding Outputs

### Aligned Images

**Location**: `results/images/{batch}/images_aligned/barcoding/{plate}/{plate}-{well}/`

**Files**: `*.tiff`

**Description**: Illumination-corrected and aligned barcoding images.

### Preprocessed Images

**Location**: `results/images/{batch}/images_corrected/barcoding/{plate}/{plate}-{well}-{site}/`

**Files**: `Plate_{plate}_Well_{well}_Site_{site}_Cycle{cycle}_{channel}.tiff`

**Description**: Barcode-called and color-compensated images, ready for stitching and combined analysis.

### Stitched Images

**Location**: `results/images/{batch}/images_corrected_stitched/barcoding/{plate}/{plate}-{well}/`

**Files**: `*.tiff`, `TileConfiguration.txt`

**Description**: Stitched preprocessed barcoding images. Generated only if `qc_barcoding_passed == true`.

### Cropped Images

**Location**: `results/images/{batch}/images_corrected_cropped/barcoding/{plate}/{plate}-{well}/`

**Files**: `*.tiff`

**Description**: Cropped barcoding images with overlap regions removed.

## Combined Analysis Outputs

This is where the final, most valuable outputs live. The combined analysis merges Cell Painting phenotype data with barcoding genotype data.

**Location**: `results/workspace/analysis/{batch}/{plate}-{well}-{site}/`

### Segmentation Masks

**Files**:

```
segmentation_masks/
  {plate}_{well}_{site}_Nuclei.tiff
  {plate}_{well}_{site}_Cells.tiff
  {plate}_{well}_{site}_Cytoplasm.tiff
```

**Description**: Binary masks for segmented objects:

- **Nuclei**: Nuclear segmentation
- **Cells**: Whole cell segmentation
- **Cytoplasm**: Cytoplasm only (Cells - Nuclei)

### Feature Measurements

**Files**:

```
Image.csv
Nuclei.csv
Cells.csv
Cytoplasm.csv
Experiment.csv
```

**Description**: CSV files containing extracted features and measurements.

#### Image.csv

Per-image measurements:

| Column           | Description               |
| ---------------- | ------------------------- |
| `ImageNumber`    | Unique image identifier   |
| `Metadata_Plate` | Plate identifier          |
| `Metadata_Well`  | Well position             |
| `Metadata_Site`  | Site number               |
| `Count_Nuclei`   | Number of nuclei detected |
| `Count_Cells`    | Number of cells detected  |

#### Nuclei.csv / Cells.csv

Per-object measurements:

| Column                      | Description                   |
| --------------------------- | ----------------------------- |
| `ObjectNumber`              | Unique object ID within image |
| `ImageNumber`               | Reference to Image.csv        |
| `Metadata_Barcode`          | Assigned barcode sequence     |
| `Location_Center_X`         | X coordinate of object center |
| `Location_Center_Y`         | Y coordinate of object center |
| `AreaShape_Area`            | Object area in pixels         |
| `Intensity_MeanIntensity_*` | Mean intensity per channel    |
| `Texture_*`                 | Texture features              |
| `Granularity_*`             | Granularity features          |

#### Experiment.csv

Pipeline metadata and run parameters.

## Quality Control Outputs

QC reports are numbered to reflect the pipeline execution order, making it easy to review them sequentially.

**Location**: `results/workspace/qc_reports/`

### 1. Illumination Painting

**Path**: `1_illumination_painting/{plate}/`

**Files**: `*.png` montages

**Description**: Visual summary of painting illumination correction functions.

### 3. Segmentation

**Path**: `3_segmentation/{plate}/`

**Files**: `*.png` montages

**Description**: Visual QC for segmentation quality. Shows sample sites with segmentation overlays.

### 4. Stitching Painting

**Path**: `4_stitching_painting/{plate}/`

**Files**: `*.png` montages

**Description**: Visual QC for painting stitching quality.

### 5. Illumination Barcoding

**Path**: `5_illumination_barcoding/{plate}/`

**Files**: `*.png` montages

**Description**: Visual summary of barcoding illumination correction functions.

### 6. Alignment

**Path**: `6_alignment/{plate}/`

**Files**: `*.html`, `*.ipynb`, `*.png`

**Description**: Barcode alignment QC reports showing cycle-to-cycle registration quality.

### 7. Preprocessing

**Path**: `7_preprocessing/{plate}/`

**Files**: `*.html`, `*.ipynb`, `*.png`

**Description**: Barcoding preprocessing QC reports.

### 8. Stitching Barcoding

**Path**: `8_stitching_barcoding/{plate}/`

**Files**: `*.png` montages

**Description**: Visual QC for barcoding stitching quality.

## MultiQC Reports

**Location**: `results/multiqc/`

**Files**: `multiqc_report.html` and associated data

**Description**: Aggregated summary of pipeline execution metrics and QC results.

## Pipeline Information

**Location**: `results/pipeline_info/`

The pipeline automatically generates execution reports and metadata in this folder.

### Execution Reports

**Files**:

- `execution_report_*.html`: Resource usage and task statistics
- `execution_timeline_*.html`: Timeline visualization of task execution
- `execution_trace_*.txt`: Detailed execution log with per-task metrics
- `pipeline_dag_*.html`: Interactive DAG visualization of the workflow

**Description**: These files are automatically generated by Nextflow and include timestamps in their filenames. They provide detailed insights into pipeline performance, resource consumption, and task dependencies.

### Pipeline Metadata

**Files**:

- `params_*.json`: JSON file containing all parameters used for the run
- `nf-pooled-cellpainting_software_mqc_versions.yml`: Software versions used by the pipeline
- `pipeline_report.html` / `pipeline_report.txt`: Summary report of the pipeline run

**Description**: These metadata files help with reproducibility by recording the exact configuration and software versions used.
